<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />

        <title>Room</title>

        <style>
            body {
                margin: 0;
                border-width: 0;
                padding: 0;
            }
        </style>

        <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    </head>

    <body>
        <canvas width="1000px" height="500px" style="background: #CCCCCC;">
            Browser does not support canvas.
        </canvas>
    </body>

    <script>
        var lastX,
            lastY;
        var leftMouseDown = false,
            rightMouseDown = false;
        var LEFT_MOUSE = 0,
            MIDDLE_MOUSE = 1,
            RIGHT_MOUSE = 2;

        function handleStart(evt) {
            evt.preventDefault();
            console.log("Touch Start");
            var el = document.getElementsByTagName("canvas")[0];
            var ctx = el.getContext("2d");

            console.log("Touch at " + evt.clientX + ", " + evt.clientY);
            ctx.beginPath();
            // a circle at the start
            ctx.arc(evt.clientX, evt.clientY, 4, 0, 2 * Math.PI, false);
            ctx.fill();

            lastX = evt.clientX;
            lastY = evt.clientY;

            switch (event.button) {
            case LEFT_MOUSE:
                leftMouseDown = true;
                break;
            case RIGHT_MOUSE:
                rightMouseDown = true;
                break;
            }
        }

        function handleMove(evt) {
            if (leftMouseDown) {
                evt.preventDefault();
                var el = document.getElementsByTagName("canvas")[0];
                var ctx = el.getContext("2d");

                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(evt.clientX, evt.clientY);
                ctx.lineWidth = 4;
                ctx.stroke();

                lastX = evt.clientX;
                lastY = evt.clientY;
            }
        }

        function handleEnd(evt) {
            evt.preventDefault();
            var el = document.getElementsByTagName("canvas")[0];
            var ctx = el.getContext("2d");

            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(evt.clientX, evt.clientY);
            // and a square at the end
            ctx.fillRect(evt.clientX - 4, evt.clientY - 4, 8, 8);

            switch (event.button) {
            case LEFT_MOUSE:
                leftMouseDown = false;
                break;
            case RIGHT_MOUSE:
                rightMouseDown = false;
                break;
            }

            console.log("Touch End");
        }

        var el = document.getElementsByTagName("canvas")[0];
        el.addEventListener("mousedown", handleStart, false);
        el.addEventListener("mouseup", handleEnd, false);
        el.addEventListener("mousemove", handleMove, false);
        console.log("Added Event Listeners");
    </script>

</html>
